---
// src/pages/marketing/propuestas/[id].astro
import Layout from '../../../layouts/MarketingLayout.astro';

// Generar rutas est√°ticas para los IDs de propuestas
export async function getStaticPaths() {
  return [
    { params: { id: '1' } },
    { params: { id: '2' } },
    { params: { id: '3' } },
    { params: { id: '4' } },
    { params: { id: '5' } },
    { params: { id: '6' } },
    { params: { id: '7' } },
    { params: { id: '8' } },
  ];
}

const { id } = Astro.params;

// Mock data (mismo que propuestas.astro)
const propuestasData = {
  '1': { 
    tema: 'Kotlin Avanzado', 
    departamento: 'Desarrollo', 
    fecha: '2025-11-04', 
    estado: 'activa',
    prioridad: 'alta', 
    descripcion: 'Curso completo de Kotlin para desarrollo Android avanzado. Enfocado en corrutinas, arquitectura limpia y mejores pr√°cticas.',
    alcance: 12500,
    engagement: 8.2,
    numCampa√±as: 3,
    ultimaCampa√±a: '2025-11-18',
    solicitudesInfo: 89,
    comentarios: 145,
    compartidos: 78,
    publico: ['Intermedios', 'Avanzados'],
    duracion: '8 semanas',
    instructor: 'Carlos P√©rez'
  },
  '2': { 
    tema: 'React Native 2025', 
    departamento: 'M√≥vil', 
    fecha: '2025-11-03', 
    estado: 'aprobada',
    prioridad: 'media', 
    descripcion: 'Desarrollo mobile con React Native y las √∫ltimas caracter√≠sticas de 2025',
    alcance: 15300,
    engagement: 9.5,
    numCampa√±as: 4,
    ultimaCampa√±a: '2025-11-15',
    solicitudesInfo: 120,
    comentarios: 198,
    compartidos: 95,
    publico: ['Intermedios'],
    duracion: '10 semanas',
    instructor: 'Ana Garc√≠a'
  },
  '3': { 
    tema: 'IA para Negocios', 
    departamento: 'Estrategia', 
    fecha: '2025-11-02', 
    estado: 'activa',
    prioridad: 'alta', 
    descripcion: 'Aplicaci√≥n de IA en estrategias empresariales',
    alcance: 7200,
    engagement: 4.1,
    numCampa√±as: 2,
    ultimaCampa√±a: '2025-11-16',
    solicitudesInfo: 34,
    comentarios: 67,
    compartidos: 28,
    publico: ['Profesionales'],
    duracion: '6 semanas',
    instructor: 'Miguel Torres'
  },
  '7': { 
    tema: 'GraphQL Avanzado', 
    departamento: 'Desarrollo', 
    fecha: '2025-10-25', 
    estado: 'borrador',
    prioridad: 'media', 
    descripcion: 'APIs modernas con GraphQL y mejores pr√°cticas',
    alcance: 0,
    engagement: 0,
    numCampa√±as: 0,
    ultimaCampa√±a: null,
    solicitudesInfo: 0,
    comentarios: 0,
    compartidos: 0,
    publico: ['Intermedios'],
    duracion: '6 semanas',
    instructor: null
  },
};

const propuesta = (id && id in propuestasData) ? propuestasData[id as keyof typeof propuestasData] : propuestasData['1'];
---

<Layout title={`${propuesta.tema} - INCADEV UI`}>
  <div class="space-y-6">
    <!-- Breadcrumb -->
    <nav class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
      <a href="/marketing/dashboard" class="hover:text-blue-600 dark:hover:text-blue-400 smooth-transition">Dashboard</a>
      <span>/</span>
      <a href="/marketing/propuestas" class="hover:text-blue-600 dark:hover:text-blue-400 smooth-transition">Propuestas</a>
      <span>/</span>
      <span class="text-gray-900 dark:text-white">{propuesta.tema}</span>
    </nav>

    <!-- Header Din√°mico -->
    <div class="bg-white dark:bg-gray-950 rounded-xl border border-gray-200 dark:border-gray-800 p-6">
      <div class="flex items-start justify-between mb-4">
        <div class="flex-1">
          <div class="flex items-center gap-3 mb-3 flex-wrap">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
              {propuesta.tema}
            </h1>
            
            <!-- Badge Estado -->
            {propuesta.estado === 'borrador' && (
              <span class="px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-400 border border-gray-300 dark:border-gray-700 rounded-full text-sm font-medium">
                üìù Borrador
              </span>
            )}
            {propuesta.estado === 'activa' && (
              <span class="px-3 py-1 bg-green-50 dark:bg-green-950/30 text-green-700 dark:text-green-400 border border-green-200 dark:border-green-900/50 rounded-full text-sm font-medium">
                üü¢ Activa
              </span>
            )}
            {propuesta.estado === 'pausada' && (
              <span class="px-3 py-1 bg-yellow-50 dark:bg-yellow-950/30 text-yellow-700 dark:text-yellow-400 border border-yellow-200 dark:border-yellow-900/50 rounded-full text-sm font-medium">
                ‚è∏Ô∏è Pausada
              </span>
            )}
            {propuesta.estado === 'aprobada' && (
              <span class="px-3 py-1 bg-emerald-50 dark:bg-emerald-950/30 text-emerald-700 dark:text-emerald-400 border border-emerald-200 dark:border-emerald-900/50 rounded-full text-sm font-medium">
                ‚úÖ Aprobada
              </span>
            )}
            {propuesta.estado === 'rechazada' && (
              <span class="px-3 py-1 bg-red-50 dark:bg-red-950/30 text-red-700 dark:text-red-400 border border-red-200 dark:border-red-900/50 rounded-full text-sm font-medium">
                ‚ùå Rechazada
              </span>
            )}

            <!-- Badge Prioridad -->
            {propuesta.prioridad === 'alta' && (
              <span class="px-3 py-1 bg-red-50 dark:bg-red-950/30 text-red-700 dark:text-red-400 border border-red-200 dark:border-red-900/50 rounded-full text-sm font-medium">
                Prioridad Alta
              </span>
            )}
            {propuesta.prioridad === 'media' && (
              <span class="px-3 py-1 bg-yellow-50 dark:bg-yellow-950/30 text-yellow-700 dark:text-yellow-400 border border-yellow-200 dark:border-yellow-900/50 rounded-full text-sm font-medium">
                Prioridad Media
              </span>
            )}
            {propuesta.prioridad === 'baja' && (
              <span class="px-3 py-1 bg-green-50 dark:bg-green-950/30 text-green-700 dark:text-green-400 border border-green-200 dark:border-green-900/50 rounded-full text-sm font-medium">
                Prioridad Baja
              </span>
            )}
          </div>

          <p class="text-gray-600 dark:text-gray-400 mb-4">
            {propuesta.descripcion}
          </p>

          <!-- Informaci√≥n b√°sica -->
          <div class="flex flex-wrap gap-4 text-sm">
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
              </svg>
              <span class="text-gray-600 dark:text-gray-400">{propuesta.departamento}</span>
            </div>
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <span class="text-gray-600 dark:text-gray-400">Creado: {new Date(propuesta.fecha).toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' })}</span>
            </div>
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span class="text-gray-600 dark:text-gray-400">Duraci√≥n: {propuesta.duracion}</span>
            </div>
            {propuesta.instructor && (
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <span class="text-gray-600 dark:text-gray-400">Instructor: {propuesta.instructor}</span>
              </div>
            )}
          </div>
        </div>

        <!-- Botones Din√°micos seg√∫n Estado -->
        <div class="flex gap-2">
          <button class="px-4 py-2 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-900 smooth-transition">
            Editar
          </button>
          
          {propuesta.estado === 'borrador' && (
            <button class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg smooth-transition" disabled>
              Crear Campa√±a Primero
            </button>
          )}
          
          {propuesta.estado === 'activa' && (
            <>
              <button class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg smooth-transition">
                Pausar
              </button>
              <button class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg smooth-transition">
                Rechazar
              </button>
            </>
          )}
          
          {propuesta.estado === 'pausada' && (
            <button class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg smooth-transition">
              Reactivar
            </button>
          )}
          
          {propuesta.estado === 'aprobada' && (
            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg smooth-transition">
              Ver Curso Creado
            </button>
          )}
          
          {propuesta.estado === 'rechazada' && (
            <button class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg smooth-transition">
              Reactivar Propuesta
            </button>
          )}
        </div>
      </div>

      <!-- P√∫blico Objetivo -->
      <div class="pt-4 border-t border-gray-200 dark:border-gray-800">
        <p class="text-sm font-semibold text-gray-900 dark:text-white mb-2">P√∫blico Objetivo:</p>
        <div class="flex gap-2 flex-wrap">
          {propuesta.publico.map((p: string) => (
            <span class="px-3 py-1 bg-blue-50 dark:bg-blue-950/30 text-blue-700 dark:text-blue-400 rounded-full text-sm">{p}</span>
          ))}
        </div>
      </div>

      <!-- M√©tricas R√°pidas (solo si no es borrador) -->
      {propuesta.estado !== 'borrador' && (
        <div class="pt-4 mt-4 border-t border-gray-200 dark:border-gray-800">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="quickMetrics">
            <!-- Se cargar√°n con JavaScript -->
          </div>
        </div>
      )}
    </div>
<!-- Tabs -->
    <div class="bg-white dark:bg-gray-950 rounded-xl border border-gray-200 dark:border-gray-800">
      <div class="border-b border-gray-200 dark:border-gray-800">
        <nav class="flex gap-1 p-2 overflow-x-auto">
          <button class="tab-btn px-6 py-3 rounded-lg font-medium smooth-transition bg-blue-50 dark:bg-blue-950/30 text-blue-600 dark:text-blue-400 whitespace-nowrap" data-tab="campa√±as">
            Campa√±as
          </button>
          <button class="tab-btn px-6 py-3 rounded-lg font-medium smooth-transition text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-900 whitespace-nowrap" data-tab="viabilidad">
            An√°lisis de Viabilidad
          </button>
          <button class="tab-btn px-6 py-3 rounded-lg font-medium smooth-transition text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-900 whitespace-nowrap" data-tab="metricas">
            M√©tricas Detalladas
          </button>
          <button class="tab-btn px-6 py-3 rounded-lg font-medium smooth-transition text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-900 whitespace-nowrap" data-tab="recursos">
            Recursos
          </button>
        </nav>
      </div>

      <!-- Tab Content: Campa√±as -->
      <div id="tab-campa√±as" class="tab-content p-6">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-1">
              Campa√±as de Validaci√≥n
            </h2>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Campa√±as educativas para medir el inter√©s del mercado
            </p>
          </div>
          <button id="btnNuevaCampa√±a" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-lg font-medium smooth-transition flex items-center gap-2 shadow-lg">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Nueva Campa√±a
          </button>
        </div>

        <!-- Campa√±as Grid -->
        <div id="campa√±asList" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Las campa√±as se cargar√°n aqu√≠ -->
        </div>

        <!-- Empty State -->
        <div id="emptyCampa√±as" class="hidden text-center py-12">
          <div class="w-20 h-20 bg-gray-100 dark:bg-gray-900 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z" />
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
            No hay campa√±as a√∫n
          </h3>
          <p class="text-gray-600 dark:text-gray-400 mb-4">
            Crea tu primera campa√±a para activar esta propuesta
          </p>
        </div>
      </div>

      <!-- Tab Content: An√°lisis de Viabilidad (NUEVO) -->
      <div id="tab-viabilidad" class="tab-content hidden p-6">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
          An√°lisis de Viabilidad del Curso
        </h2>

        <!-- Score Principal -->
        <div class="p-6 bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20 rounded-xl border border-blue-200 dark:border-blue-900/50 mb-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Score de Viabilidad</p>
              <div class="flex items-baseline gap-3">
                <p id="scoreValue" class="text-5xl font-bold text-gray-900 dark:text-white">--</p>
                <span class="text-2xl text-gray-500 dark:text-gray-400">/100</span>
              </div>
            </div>
            <div id="scoreIcon" class="text-6xl">
              <!-- Icono din√°mico -->
            </div>
          </div>
          
          <!-- Barra de progreso -->
          <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 overflow-hidden mb-3">
            <div id="scoreBar" class="h-4 rounded-full smooth-transition" style="width: 0%"></div>
          </div>
          
          <p id="scoreLabel" class="text-sm font-medium"></p>
        </div>

        <!-- Desglose del Score -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
            Desglose del C√°lculo
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="p-4 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-900/50">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-blue-700 dark:text-blue-400">Alcance</span>
                <span id="alcancePuntos" class="text-lg font-bold text-gray-900 dark:text-white">-- pts</span>
              </div>
              <p class="text-xs text-gray-600 dark:text-gray-400">Alcance total / 200</p>
            </div>

            <div class="p-4 bg-green-50 dark:bg-green-950/30 rounded-lg border border-green-200 dark:border-green-900/50">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-green-700 dark:text-green-400">Engagement</span>
                <span id="engagementPuntos" class="text-lg font-bold text-gray-900 dark:text-white">-- pts</span>
              </div>
              <p class="text-xs text-gray-600 dark:text-gray-400">Engagement √ó 8</p>
            </div>

            <div class="p-4 bg-purple-50 dark:bg-purple-950/30 rounded-lg border border-purple-200 dark:border-purple-900/50">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-purple-700 dark:text-purple-400">Solicitudes</span>
                <span id="solicitudesPuntos" class="text-lg font-bold text-gray-900 dark:text-white">-- pts</span>
              </div>
              <p class="text-xs text-gray-600 dark:text-gray-400">Solicitudes √ó 0.3</p>
            </div>

            <div class="p-4 bg-orange-50 dark:bg-orange-950/30 rounded-lg border border-orange-200 dark:border-orange-900/50">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-orange-700 dark:text-orange-400">Comentarios</span>
                <span id="comentariosPuntos" class="text-lg font-bold text-gray-900 dark:text-white">-- pts</span>
              </div>
              <p class="text-xs text-gray-600 dark:text-gray-400">Comentarios √ó 0.15</p>
            </div>
          </div>
        </div>

        <!-- Se√±ales de Compra -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
            Se√±ales de Inter√©s Real
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="p-4 bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div>
                  <p class="text-2xl font-bold text-gray-900 dark:text-white" id="preguntasPrecio">--</p>
                  <p class="text-xs text-gray-600 dark:text-gray-400">Preguntas sobre precio</p>
                </div>
              </div>
            </div>

            <div class="p-4 bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                </div>
                <div>
                  <p class="text-2xl font-bold text-gray-900 dark:text-white" id="preguntasFecha">--</p>
                  <p class="text-xs text-gray-600 dark:text-gray-400">Preguntas sobre fecha</p>
                </div>
              </div>
            </div>

            <div class="p-4 bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                  </svg>
                </div>
                <div>
                  <p class="text-2xl font-bold text-gray-900 dark:text-white" id="avisame">--</p>
                  <p class="text-xs text-gray-600 dark:text-gray-400">"Av√≠same cuando abran"</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Comparativa -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
            Comparativa con Propuestas Exitosas
          </h3>
          <div class="p-4 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800">
            <div class="flex items-center justify-between mb-3">
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300">vs. Promedio de Aprobadas</span>
              <span id="vsAprobadas" class="text-sm font-bold">--</span>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
              <div id="barVsAprobadas" class="h-2 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full smooth-transition" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <!-- Recomendaci√≥n Final -->
        <div id="recomendacionFinal" class="p-6 rounded-xl border-2">
          <!-- Se llenar√° din√°micamente -->
        </div>
      </div>

      <!-- Tab Content: M√©tricas Detalladas -->
      <div id="tab-metricas" class="tab-content hidden p-6">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
          M√©tricas Completas de Campa√±as
        </h2>
        
        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
          <div class="p-6 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/30 dark:to-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-900/50">
            <p class="text-sm font-medium text-blue-600 dark:text-blue-400 mb-2">Total Alcance</p>
            <p id="metricaAlcance" class="text-3xl font-bold text-gray-900 dark:text-white">--</p>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Personas alcanzadas</p>
          </div>
          <div class="p-6 bg-gradient-to-br from-green-50 to-green-100 dark:from-green-950/30 dark:to-green-900/20 rounded-xl border border-green-200 dark:border-green-900/50">
            <p class="text-sm font-medium text-green-600 dark:text-green-400 mb-2">Engagement</p>
            <p id="metricaEngagement" class="text-3xl font-bold text-gray-900 dark:text-white">--%</p>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Tasa de interacci√≥n</p>
          </div>
          <div class="p-6 bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-950/30 dark:to-purple-900/20 rounded-xl border border-purple-200 dark:border-purple-900/50">
            <p class="text-sm font-medium text-purple-600 dark:text-purple-400 mb-2">Solicitudes</p>
            <p id="metricaSolicitudes" class="text-3xl font-bold text-gray-900 dark:text-white">--</p>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Pidieron informaci√≥n</p>
          </div>
          <div class="p-6 bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-950/30 dark:to-orange-900/20 rounded-xl border border-orange-200 dark:border-orange-900/50">
            <p class="text-sm font-medium text-orange-600 dark:text-orange-400 mb-2">Compartidos</p>
            <p id="metricaCompartidos" class="text-3xl font-bold text-gray-900 dark:text-white">--</p>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Shares totales</p>
          </div>
        </div>

        <!-- Detalle adicional -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="p-6 bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800">
            <h3 class="font-semibold text-gray-900 dark:text-white mb-4">Interacciones</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600 dark:text-gray-400">Likes</span>
                <span id="metricaLikes" class="text-sm font-bold text-gray-900 dark:text-white">--</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600 dark:text-gray-400">Comentarios</span>
                <span id="metricaComentarios" class="text-sm font-bold text-gray-900 dark:text-white">--</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600 dark:text-gray-400">Guardados</span>
                <span id="metricaGuardados" class="text-sm font-bold text-gray-900 dark:text-white">--</span>
              </div>
            </div>
          </div>

          <div class="p-6 bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800">
            <h3 class="font-semibold text-gray-900 dark:text-white mb-4">Rendimiento</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600 dark:text-gray-400">Campa√±as Activas</span>
                <span id="metricaCampa√±as" class="text-sm font-bold text-gray-900 dark:text-white">--</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600 dark:text-gray-400">√öltima Campa√±a</span>
                <span id="metricaUltima" class="text-sm font-bold text-gray-900 dark:text-white">--</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600 dark:text-gray-400">D√≠as Activos</span>
                <span id="metricaDias" class="text-sm font-bold text-gray-900 dark:text-white">--</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Chart Placeholder -->
        <div class="mt-6 p-12 bg-gray-50 dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 text-center">
          <p class="text-gray-600 dark:text-gray-400">
            üìä Gr√°fico de evoluci√≥n temporal (Se conectar√° con Meta Analytics)
          </p>
        </div>
      </div>

      <!-- Tab Content: Recursos -->
      <div id="tab-recursos" class="tab-content hidden p-6">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
          Recursos y Materiales
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="p-6 bg-gray-50 dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 text-center hover:shadow-lg smooth-transition cursor-pointer group">
            <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 smooth-transition">
              <svg class="w-8 h-8 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
              </svg>
            </div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Syllabus</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Programa del curso</p>
            <button class="text-sm text-blue-600 dark:text-blue-400 hover:underline font-medium">Ver documento</button>
          </div>

          <div class="p-6 bg-gray-50 dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 text-center hover:shadow-lg smooth-transition cursor-pointer group">
            <div class="w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 smooth-transition">
              <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Im√°genes</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Assets visuales</p>
            <button class="text-sm text-green-600 dark:text-green-400 hover:underline font-medium">Ver galer√≠a (12)</button>
          </div>

          <div class="p-6 bg-gray-50 dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 text-center hover:shadow-lg smooth-transition cursor-pointer group">
            <div class="w-16 h-16 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 smooth-transition">
              <svg class="w-8 h-8 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
            </div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Videos</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Material audiovisual</p>
            <button class="text-sm text-purple-600 dark:text-purple-400 hover:underline font-medium">Ver videos (5)</button>
          </div>
        </div>
      </div>
    </div>
  </div>
<!-- Modal Nueva Campa√±a (igual que antes pero mejorado) -->
  <div id="modalNuevaCampa√±a" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
    <div class="bg-white dark:bg-gray-950 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-gray-800">
      <div class="p-6 border-b border-gray-200 dark:border-gray-800 sticky top-0 bg-white dark:bg-gray-950 z-10">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
              Nueva Campa√±a de Validaci√≥n
            </h2>
            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
              Crea contenido educativo para medir el inter√©s del mercado
            </p>
          </div>
          <button id="btnCerrarModalCampa√±a" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-900 rounded-lg smooth-transition">
            <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>

      <form id="formNuevaCampa√±a" class="p-6 space-y-8">
        <!-- Informaci√≥n b√°sica -->
        <div class="space-y-6">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2">
            <span class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center text-sm font-bold">1</span>
            Informaci√≥n B√°sica
          </h3>
          
          <div>
            <label class="block text-sm font-semibold text-gray-900 dark:text-white mb-2">
              Nombre de la Campa√±a *
            </label>
            <input
              type="text"
              required
              placeholder="Ej: Contenido Educativo - Kotlin Tips"
              class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-800 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white"
            />
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-semibold text-gray-900 dark:text-white mb-2">
                Fecha de Inicio *
              </label>
              <input
                type="date"
                required
                class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-800 rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white"
              />
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-900 dark:text-white mb-2">
                Fecha de Fin *
              </label>
              <input
                type="date"
                required
                class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-800 rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white"
              />
            </div>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-900 dark:text-white mb-2">
              Presupuesto (Opcional)
            </label>
            <div class="relative">
              <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">$</span>
              <input
                type="number"
                placeholder="500"
                class="w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-800 rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white"
              />
            </div>
          </div>
        </div>

        <!-- Plataformas -->
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2">
            <span class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center text-sm font-bold">2</span>
            Plataformas
          </h3>
          
          <div class="grid grid-cols-2 gap-4">
            <label class="flex items-center gap-3 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 smooth-transition border-2 border-transparent hover:border-blue-500 dark:hover:border-blue-500">
              <input type="checkbox" value="facebook" class="w-5 h-5 text-blue-600 rounded" />
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                  <span class="text-white font-bold">f</span>
                </div>
                <div>
                  <p class="font-semibold text-gray-900 dark:text-white">Facebook</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">Posts e im√°genes</p>
                </div>
              </div>
            </label>

            <label class="flex items-center gap-3 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 smooth-transition border-2 border-transparent hover:border-blue-500 dark:hover:border-blue-500">
              <input type="checkbox" value="instagram" class="w-5 h-5 text-blue-600 rounded" />
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-purple-600 to-pink-600 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                  </svg>
                </div>
                <div>
                  <p class="font-semibold text-gray-900 dark:text-white">Instagram</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">Posts y Stories</p>
                </div>
              </div>
            </label>
          </div>
        </div>

        <!-- Contenido a crear -->
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2">
            <span class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center text-sm font-bold">3</span>
            Tipos de Contenido Educativo
          </h3>
          
          <div class="grid grid-cols-3 gap-4">
            <label class="group relative flex flex-col items-center gap-3 p-6 bg-gray-50 dark:bg-gray-900 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 smooth-transition border-2 border-transparent hover:border-blue-500 dark:hover:border-blue-500">
              <input type="checkbox" value="posts" class="w-5 h-5 text-blue-600 rounded" />
              <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center group-hover:scale-110 smooth-transition">
                <svg class="w-8 h-8 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                </svg>
              </div>
              <div class="text-center">
                <p class="font-semibold text-gray-900 dark:text-white">Posts</p>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Tips y consejos</p>
              </div>
            </label>

            <label class="group relative flex flex-col items-center gap-3 p-6 bg-gray-50 dark:bg-gray-900 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 smooth-transition border-2 border-transparent hover:border-purple-500 dark:hover:border-purple-500">
              <input type="checkbox" value="videos" class="w-5 h-5 text-blue-600 rounded" />
              <div class="w-16 h-16 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center group-hover:scale-110 smooth-transition">
                <svg class="w-8 h-8 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
              </div>
              <div class="text-center">
                <p class="font-semibold text-gray-900 dark:text-white">Videos</p>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Tutoriales cortos</p>
              </div>
            </label>

            <label class="group relative flex flex-col items-center gap-3 p-6 bg-gray-50 dark:bg-gray-900 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 smooth-transition border-2 border-transparent hover:border-green-500 dark:hover:border-green-500">
              <input type="checkbox" value="imagenes" class="w-5 h-5 text-blue-600 rounded" />
              <div class="w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center group-hover:scale-110 smooth-transition">
                <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
              </div>
              <div class="text-center">
                <p class="font-semibold text-gray-900 dark:text-white">Infograf√≠as</p>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Contenido visual</p>
              </div>
            </label>
          </div>
        </div>

        <!-- Info Box -->
        <div class="p-4 bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-900/50 rounded-lg">
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div>
              <p class="text-sm font-medium text-blue-900 dark:text-blue-300 mb-1">
                üí° Primera campa√±a
              </p>
              <p class="text-xs text-blue-700 dark:text-blue-400">
                Al crear tu primera campa√±a, la propuesta pasar√° autom√°ticamente de "Borrador" a "Activa" y empezar√°s a recopilar m√©tricas.
              </p>
            </div>
          </div>
        </div>

        <!-- Buttons -->
        <div class="flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-800">
          <button
            type="button"
            id="btnCancelarCampa√±a"
            class="flex-1 px-6 py-3 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-900 smooth-transition"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-lg font-medium smooth-transition shadow-lg"
          >
            Crear Campa√±a
          </button>
        </div>
      </form>
    </div>
  </div>

  <script define:vars={{ propuesta, id }}>
    // ============================================
    // DATOS DE LA PROPUESTA
    // ============================================
    const propuestaData = propuesta;
    const propuestaId = id;

    // Campa√±as mock
    let campa√±as = propuestaId === '1' ? [
      {
        id: 1,
        nombre: 'Contenido Educativo Kotlin',
        plataformas: ['facebook', 'instagram'],
        inicio: '2025-11-10',
        fin: '2025-11-20',
        estado: 'activa',
        posts: 5,
        videos: 2,
        alcance: '8.5K'
      },
      {
        id: 2,
        nombre: 'Tips Avanzados',
        plataformas: ['facebook'],
        inicio: '2025-11-05',
        fin: '2025-11-12',
        estado: 'finalizada',
        posts: 3,
        videos: 1,
        alcance: '4.0K'
      }
    ] : [];

    // ============================================
    // FUNCIONES DE C√ÅLCULO
    // ============================================
    function calcularScoreViabilidad(p) {
      if (p.estado === 'borrador') return 0;
      const score = (p.alcance / 200) + (p.engagement * 8) + (p.solicitudesInfo * 0.3) + (p.comentarios * 0.15);
      return Math.min(Math.round(score), 100);
    }

    function getViabilidadConfig(score) {
      if (score >= 85) return { 
        nivel: 'muy-viable', 
        label: 'Muy Viable - Listo para Aprobar', 
        icon: 'üü¢',
        color: 'text-green-600 dark:text-green-400',
        bg: 'bg-green-50 dark:bg-green-950/30',
        border: 'border-green-500',
        barColor: 'bg-gradient-to-r from-green-500 to-emerald-500'
      };
      if (score >= 65) return { 
        nivel: 'viable', 
        label: 'Viable - Buen Potencial', 
        icon: 'üü°',
        color: 'text-yellow-600 dark:text-yellow-400',
        bg: 'bg-yellow-50 dark:bg-yellow-950/30',
        border: 'border-yellow-500',
        barColor: 'bg-gradient-to-r from-yellow-500 to-orange-500'
      };
      if (score >= 40) return { 
        nivel: 'dudoso', 
        label: 'Dudoso - Necesita M√°s Validaci√≥n', 
        icon: 'üü†',
        color: 'text-orange-600 dark:text-orange-400',
        bg: 'bg-orange-50 dark:bg-orange-950/30',
        border: 'border-orange-500',
        barColor: 'bg-gradient-to-r from-orange-500 to-red-500'
      };
      return { 
        nivel: 'no-viable', 
        label: 'No Viable - Bajo Inter√©s', 
        icon: 'üî¥',
        color: 'text-red-600 dark:text-red-400',
        bg: 'bg-red-50 dark:bg-red-950/30',
        border: 'border-red-500',
        barColor: 'bg-gradient-to-r from-red-500 to-red-600'
      };
    }

    // ============================================
    // INICIALIZAR DATOS
    // ============================================
    document.addEventListener('DOMContentLoaded', () => {
      const score = calcularScoreViabilidad(propuestaData);
      const viab = getViabilidadConfig(score);

      // Quick Metrics (header)
      if (propuestaData.estado !== 'borrador') {
        const quickMetrics = document.getElementById('quickMetrics');
        if (quickMetrics) {
          quickMetrics.innerHTML = `
            <div class="text-center">
              <p class="text-sm text-gray-600 dark:text-gray-400">Alcance</p>
              <p class="text-2xl font-bold text-gray-900 dark:text-white">${(propuestaData.alcance / 1000).toFixed(1)}K</p>
            </div>
            <div class="text-center">
              <p class="text-sm text-gray-600 dark:text-gray-400">Engagement</p>
              <p class="text-2xl font-bold text-gray-900 dark:text-white">${propuestaData.engagement}%</p>
            </div>
            <div class="text-center">
              <p class="text-sm text-gray-600 dark:text-gray-400">Score</p>
              <p class="text-2xl font-bold ${viab.color}">${score}/100</p>
            </div>
            <div class="text-center">
              <p class="text-sm text-gray-600 dark:text-gray-400">Solicitudes</p>
              <p class="text-2xl font-bold text-gray-900 dark:text-white">${propuestaData.solicitudesInfo}</p>
            </div>
          `;
        }
      }

      // Tab Viabilidad
      if (propuestaData.estado !== 'borrador') {
        document.getElementById('scoreValue').textContent = score;
        document.getElementById('scoreIcon').textContent = viab.icon;
        document.getElementById('scoreLabel').textContent = viab.label;
        document.getElementById('scoreLabel').className = `text-sm font-medium ${viab.color}`;
        
        const scoreBar = document.getElementById('scoreBar');
        scoreBar.className = `h-4 rounded-full smooth-transition ${viab.barColor}`;
        scoreBar.style.width = `${score}%`;

        // Desglose
        document.getElementById('alcancePuntos').textContent = Math.round(propuestaData.alcance / 200) + ' pts';
        document.getElementById('engagementPuntos').textContent = Math.round(propuestaData.engagement * 8) + ' pts';
        document.getElementById('solicitudesPuntos').textContent = Math.round(propuestaData.solicitudesInfo * 0.3) + ' pts';
        document.getElementById('comentariosPuntos').textContent = Math.round(propuestaData.comentarios * 0.15) + ' pts';

        // Se√±ales
        document.getElementById('preguntasPrecio').textContent = Math.round(propuestaData.solicitudesInfo * 0.4);
        document.getElementById('preguntasFecha').textContent = Math.round(propuestaData.solicitudesInfo * 0.3);
        document.getElementById('avisame').textContent = Math.round(propuestaData.solicitudesInfo * 0.3);

        // Comparativa (vs promedio 72)
        const promedio = 72;
        const vsPromedio = Math.round((score / promedio) * 100);
        document.getElementById('vsAprobadas').textContent = `${vsPromedio}% del promedio`;
        document.getElementById('barVsAprobadas').style.width = `${Math.min(vsPromedio, 100)}%`;

        // Recomendaci√≥n
        const recomendacion = document.getElementById('recomendacionFinal');
        if (score >= 85) {
          recomendacion.className = `p-6 rounded-xl border-2 ${viab.border} ${viab.bg}`;
          recomendacion.innerHTML = `
            <div class="flex items-start gap-4">
              <div class="text-5xl">${viab.icon}</div>
              <div>
                <h4 class="text-lg font-bold ${viab.color} mb-2">‚úÖ Listo para Aprobar</h4>
                <p class="text-sm text-gray-700 dark:text-gray-300 mb-3">
                  Esta propuesta muestra se√±ales muy positivas de inter√©s del mercado. El engagement y las solicitudes de informaci√≥n indican una demanda real. Se recomienda proceder con la creaci√≥n del curso.
                </p>
                <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                  <li>‚úì Alcance superior al promedio</li>
                  <li>‚úì Alta tasa de engagement (${propuestaData.engagement}%)</li>
                  <li>‚úì M√∫ltiples se√±ales de compra</li>
                </ul>
              </div>
            </div>
          `;
        } else if (score >= 65) {
          recomendacion.className = `p-6 rounded-xl border-2 ${viab.border} ${viab.bg}`;
          recomendacion.innerHTML = `
            <div class="flex items-start gap-4">
              <div class="text-5xl">${viab.icon}</div>
              <div>
                <h4 class="text-lg font-bold ${viab.color} mb-2">üéØ Buen Potencial</h4>
                <p class="text-sm text-gray-700 dark:text-gray-300 mb-3">
                  La propuesta muestra potencial, pero se recomienda validar un poco m√°s antes de aprobar. Considera extender las campa√±as 1-2 semanas adicionales.
                </p>
              </div>
            </div>
          `;
        } else {
          recomendacion.className = `p-6 rounded-xl border-2 ${viab.border} ${viab.bg}`;
          recomendacion.innerHTML = `
            <div class="flex items-start gap-4">
              <div class="text-5xl">${viab.icon}</div>
              <div>
                <h4 class="text-lg font-bold ${viab.color} mb-2">‚ö†Ô∏è Necesita M√°s Validaci√≥n</h4>
                <p class="text-sm text-gray-700 dark:text-gray-300 mb-3">
                  El inter√©s actual es bajo. Se recomienda ajustar la estrategia de contenido o considerar pausar temporalmente.
                </p>
              </div>
            </div>
          `;
        }
      }

      // Tab M√©tricas
      if (propuestaData.estado !== 'borrador') {
        document.getElementById('metricaAlcance').textContent = (propuestaData.alcance / 1000).toFixed(1) + 'K';
        document.getElementById('metricaEngagement').textContent = propuestaData.engagement + '%';
        document.getElementById('metricaSolicitudes').textContent = propuestaData.solicitudesInfo;
        document.getElementById('metricaCompartidos').textContent = propuestaData.compartidos;
        document.getElementById('metricaLikes').textContent = Math.round(propuestaData.alcance * 0.05);
        document.getElementById('metricaComentarios').textContent = propuestaData.comentarios;
        document.getElementById('metricaGuardados').textContent = Math.round(propuestaData.comentarios * 0.3);
        document.getElementById('metricaCampa√±as').textContent = propuestaData.numCampa√±as;
        document.getElementById('metricaUltima').textContent = propuestaData.ultimaCampa√±a ? new Date(propuestaData.ultimaCampa√±a).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' }) : '-';
        const diasActivo = Math.floor((new Date() - new Date(propuestaData.fecha)) / (1000 * 60 * 60 * 24));
        document.getElementById('metricaDias').textContent = diasActivo;
      }

      // Renderizar campa√±as
      renderCampa√±as();

      // Tabs
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const tab = btn.getAttribute('data-tab');
          
          document.querySelectorAll('.tab-btn').forEach(b => {
            b.classList.remove('bg-blue-50', 'dark:bg-blue-950/30', 'text-blue-600', 'dark:text-blue-400');
            b.classList.add('text-gray-600', 'dark:text-gray-400');
          });
          btn.classList.add('bg-blue-50', 'dark:bg-blue-950/30', 'text-blue-600', 'dark:text-blue-400');
          btn.classList.remove('text-gray-600', 'dark:text-gray-400');
          
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden');
          });
          document.getElementById(`tab-${tab}`)?.classList.remove('hidden');
        });
      });

      // Modal
      const modal = document.getElementById('modalNuevaCampa√±a');
      const btnAbrir = document.getElementById('btnNuevaCampa√±a');
      const btnCerrar = document.getElementById('btnCerrarModalCampa√±a');
      const btnCancelar = document.getElementById('btnCancelarCampa√±a');

      btnAbrir?.addEventListener('click', () => {
        modal?.classList.remove('hidden');
        modal?.classList.add('flex');
      });

      [btnCerrar, btnCancelar].forEach(btn => {
        btn?.addEventListener('click', () => {
          modal?.classList.add('hidden');
          modal?.classList.remove('flex');
        });
      });

      modal?.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.add('hidden');
          modal.classList.remove('flex');
        }
      });

      document.getElementById('formNuevaCampa√±a')?.addEventListener('submit', (e) => {
        e.preventDefault();
        const nuevaCampa√±a = {
          id: campa√±as.length + 1,
          nombre: 'Nueva Campa√±a',
          plataformas: ['facebook', 'instagram'],
          inicio: '2025-12-01',
          fin: '2025-12-15',
          estado: 'activa',
          posts: 0,
          videos: 0,
          alcance: '0'
        };
        campa√±as.push(nuevaCampa√±a);
        renderCampa√±as();
        modal?.classList.add('hidden');
        modal?.classList.remove('flex');
        alert('‚úÖ ¬°Campa√±a creada! La propuesta ahora est√° ACTIVA.');
      });
    });

    function renderCampa√±as() {
      const container = document.getElementById('campa√±asList');
      const emptyState = document.getElementById('emptyCampa√±as');
      
      if (campa√±as.length === 0) {
        container?.classList.add('hidden');
        emptyState?.classList.remove('hidden');
        return;
      }

      container?.classList.remove('hidden');
      emptyState?.classList.add('hidden');

      if (!container) return;
      container.innerHTML = campa√±as.map(c => {
        const estadoColor = c.estado === 'activa' 
          ? 'bg-green-50 dark:bg-green-950/30 text-green-700 dark:text-green-400 border-green-200 dark:border-green-900/50'
          : 'bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 border-gray-200 dark:border-gray-700';

        return `
          <div class="p-6 bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl hover:shadow-lg smooth-transition group">
            <div class="flex items-start justify-between mb-4">
              <div class="flex-1">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 smooth-transition">
                  ${c.nombre}
                </h3>
                <div class="flex items-center gap-2 mb-3">
                  ${c.plataformas.map(p => {
                    return p === 'facebook' 
                      ? '<span class="w-6 h-6 bg-blue-600 rounded flex items-center justify-center text-white text-xs font-bold">f</span>'
                      : '<span class="w-6 h-6 bg-gradient-to-br from-purple-600 to-pink-600 rounded flex items-center justify-center text-white text-xs">üì∏</span>';
                  }).join('')}
                </div>
              </div>
              <span class="px-3 py-1 ${estadoColor} border rounded-full text-xs font-medium capitalize">
                ${c.estado}
              </span>
            </div>

            <div class="grid grid-cols-3 gap-4 mb-4">
              <div class="text-center p-3 bg-gray-50 dark:bg-gray-900 rounded-lg">
                <p class="text-2xl font-bold text-gray-900 dark:text-white">${c.posts}</p>
                <p class="text-xs text-gray-600 dark:text-gray-400">Posts</p>
              </div>
              <div class="text-center p-3 bg-gray-50 dark:bg-gray-900 rounded-lg">
                <p class="text-2xl font-bold text-gray-900 dark:text-white">${c.videos}</p>
                <p class="text-xs text-gray-600 dark:text-gray-400">Videos</p>
              </div>
              <div class="text-center p-3 bg-gray-50 dark:bg-gray-900 rounded-lg">
                <p class="text-2xl font-bold text-gray-900 dark:text-white">${c.alcance}</p>
                <p class="text-xs text-gray-600 dark:text-gray-400">Alcance</p>
              </div>
            </div>

            <div class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-400 mb-4">
              <span>${new Date(c.inicio).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })}</span>
              <span>‚Üí</span>
              <span>${new Date(c.fin).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })}</span>
            </div>

            <div class="flex gap-2">
              <button class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium smooth-transition">
                Ver Detalles
              </button>
              <button class="px-4 py-2 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 dark:hover:bg-gray-900 smooth-transition">
                Editar
              </button>
            </div>
          </div>
        `;
      }).join('');
    }
  </script>
</Layout>