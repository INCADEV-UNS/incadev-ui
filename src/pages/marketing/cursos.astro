---
// src/pages/marketing/cursos.astro
import Layout from "../../layouts/MarketingLayout.astro";
---

<Layout title="Cursos - INCADEV UI">
  <div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
          Gesti√≥n de Cursos
        </h1>
        <p class="text-gray-600 dark:text-gray-400">
          Administra cursos activos y gestiona campa√±as de captaci√≥n de alumnos
        </p>
      </div>

      <!-- CORRECCI√ìN: Se agreg√≥ la etiqueta <a> que faltaba -->
      <a
        href="/marketing/propuestas"
        class="px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-lg font-medium smooth-transition flex items-center gap-2 shadow-lg hover:shadow-xl"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
          ></path>
        </svg>
        Ver Propuestas Aprobadas
      </a>
    </div>

    <!-- Stats Grid - Estados de Cursos -->
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
      <button
        class="filter-btn p-4 bg-white dark:bg-gray-950 border-2 border-blue-500 dark:border-blue-500 rounded-lg smooth-transition hover:shadow-md"
        data-filter="todos"
      >
        <div class="text-center">
          <p class="text-2xl font-bold text-gray-900 dark:text-white">15</p>
          <p class="text-xs text-gray-600 dark:text-gray-400 mt-1 font-medium">
            Todos
          </p>
        </div>
      </button>

      <button
        class="filter-btn p-4 bg-white dark:bg-gray-950 border-2 border-gray-200 dark:border-gray-800 hover:border-blue-500 dark:hover:border-blue-500 rounded-lg smooth-transition hover:shadow-md"
        data-filter="planificacion"
      >
        <div class="text-center">
          <p class="text-2xl font-bold text-blue-600 dark:text-blue-400">3</p>
          <p class="text-xs text-gray-600 dark:text-gray-400 mt-1 font-medium">
            Planificaci√≥n
          </p>
        </div>
      </button>

      <button
        class="filter-btn p-4 bg-white dark:bg-gray-950 border-2 border-gray-200 dark:border-gray-800 hover:border-yellow-500 dark:hover:border-yellow-500 rounded-lg smooth-transition hover:shadow-md"
        data-filter="prelanzamiento"
      >
        <div class="text-center">
          <p class="text-2xl font-bold text-yellow-600 dark:text-yellow-400">
            2
          </p>
          <p class="text-xs text-gray-600 dark:text-gray-400 mt-1 font-medium">
            Pre-lanzamiento
          </p>
        </div>
      </button>

      <button
        class="filter-btn p-4 bg-white dark:bg-gray-950 border-2 border-gray-200 dark:border-gray-800 hover:border-green-500 dark:hover:border-green-500 rounded-lg smooth-transition hover:shadow-md"
        data-filter="abierto"
      >
        <div class="text-center">
          <p class="text-2xl font-bold text-green-600 dark:text-green-400">5</p>
          <p class="text-xs text-gray-600 dark:text-gray-400 mt-1 font-medium">
            Abiertos
          </p>
        </div>
      </button>

      <button
        class="filter-btn p-4 bg-white dark:bg-gray-950 border-2 border-gray-200 dark:border-gray-800 hover:border-purple-500 dark:hover:border-purple-500 rounded-lg smooth-transition hover:shadow-md"
        data-filter="en_curso"
      >
        <div class="text-center">
          <p class="text-2xl font-bold text-purple-600 dark:text-purple-400">
            4
          </p>
          <p class="text-xs text-gray-600 dark:text-gray-400 mt-1 font-medium">
            En Curso
          </p>
        </div>
      </button>

      <button
        class="filter-btn p-4 bg-white dark:bg-gray-950 border-2 border-gray-200 dark:border-gray-800 hover:border-gray-500 dark:hover:border-gray-500 rounded-lg smooth-transition hover:shadow-md"
        data-filter="finalizado"
      >
        <div class="text-center">
          <p class="text-2xl font-bold text-gray-600 dark:text-gray-400">1</p>
          <p class="text-xs text-gray-600 dark:text-gray-400 mt-1 font-medium">
            Finalizados
          </p>
        </div>
      </button>
    </div>

    <!-- Search and Filter Bar -->
    <div class="flex flex-col lg:flex-row gap-4">
      <div class="flex-1">
        <div class="relative">
          <svg
            class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          <input
            id="searchInput"
            type="text"
            placeholder="Buscar cursos por nombre..."
            class="w-full pl-12 pr-4 py-3 bg-white dark:bg-gray-950 border border-gray-300 dark:border-gray-800 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"
          />
        </div>
      </div>

      <select
        id="filterInstructor"
        class="px-4 py-3 bg-white dark:bg-gray-950 border border-gray-300 dark:border-gray-800 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
      >
        <option value="">Todos los instructores</option>
        <option value="Carlos P√©rez">Carlos P√©rez</option>
        <option value="Ana Garc√≠a">Ana Garc√≠a</option>
        <option value="Miguel Torres">Miguel Torres</option>
      </select>

      <select
        id="filterNivel"
        class="px-4 py-3 bg-white dark:bg-gray-950 border border-gray-300 dark:border-gray-800 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
      >
        <option value="">Todos los niveles</option>
        <option value="Principiante">Principiante</option>
        <option value="Intermedio">Intermedio</option>
        <option value="Avanzado">Avanzado</option>
      </select>

      <button
        id="btnLimpiarFiltros"
        class="px-6 py-3 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-900 smooth-transition font-medium"
      >
        Limpiar
      </button>
    </div>

    <!-- Cursos List -->
    <div id="cursosList" class="grid grid-cols-1 gap-4">
      <!-- Los cursos se cargar√°n aqu√≠ din√°micamente -->
    </div>

    <!-- Empty State -->
    <div id="emptyState" class="hidden text-center py-12">
      <div
        class="w-20 h-20 bg-gray-100 dark:bg-gray-900 rounded-full flex items-center justify-center mx-auto mb-4"
      >
        <svg
          class="w-10 h-10 text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
          ></path>
        </svg>
      </div>
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
        No se encontraron cursos
      </h3>
      <p class="text-gray-600 dark:text-gray-400 mb-4">
        Intenta ajustar los filtros o revisa las propuestas aprobadas
      </p>
    </div>
  </div>

  <script>
    // ============================================
    // MOCK DATA DE CURSOS
    // ============================================
    const cursos: Curso[] = [
      {
        id: 1,
        nombre: "Kotlin Avanzado para Android",
        instructor: "Carlos P√©rez",
        inicio: "2025-12-01",
        duracion: "8 semanas",
        estado: "abierto",
        nivel: "Avanzado",
        cupoTotal: 60,
        cupoOcupado: 45,
        precio: 500,
        leads: 89,
        conversion: 18,
        cac: 28,
        propuestaOrigen: "Kotlin Avanzado",
      },
      {
        id: 2,
        nombre: "React Native PRO 2025",
        instructor: "Ana Garc√≠a",
        inicio: "2025-11-25",
        duracion: "10 semanas",
        estado: "abierto",
        nivel: "Intermedio",
        cupoTotal: 50,
        cupoOcupado: 38,
        precio: 450,
        leads: 120,
        conversion: 22,
        cac: 32,
        propuestaOrigen: "React Native 2025",
      },
      {
        id: 3,
        nombre: "Python Machine Learning",
        instructor: "Miguel Torres",
        inicio: "2025-12-10",
        duracion: "12 semanas",
        estado: "prelanzamiento",
        nivel: "Intermedio",
        cupoTotal: 60,
        cupoOcupado: 15,
        precio: 550,
        leads: 45,
        conversion: 15,
        cac: 35,
        propuestaOrigen: "Python Machine Learning",
      },
      {
        id: 4,
        nombre: "Docker y Kubernetes",
        instructor: "Carlos P√©rez",
        inicio: "2025-11-20",
        duracion: "6 semanas",
        estado: "en_curso",
        nivel: "Avanzado",
        cupoTotal: 40,
        cupoOcupado: 40,
        precio: 480,
        leads: 95,
        conversion: 28,
        cac: 25,
        propuestaOrigen: "Docker y Kubernetes",
      },
      {
        id: 5,
        nombre: "Flutter Desarrollo M√≥vil",
        instructor: "Ana Garc√≠a",
        inicio: "2025-12-15",
        duracion: "8 semanas",
        estado: "abierto",
        nivel: "Intermedio",
        cupoTotal: 50,
        cupoOcupado: 28,
        precio: 470,
        leads: 67,
        conversion: 19,
        cac: 30,
        propuestaOrigen: "Flutter Desarrollo",
      },
      {
        id: 6,
        nombre: "Ciberseguridad Empresarial",
        instructor: "Miguel Torres",
        inicio: "2026-01-10",
        duracion: "10 semanas",
        estado: "planificacion",
        nivel: "Avanzado",
        cupoTotal: 35,
        cupoOcupado: 0,
        precio: 600,
        leads: 0,
        conversion: 0,
        cac: 0,
        propuestaOrigen: "Ciberseguridad Empresarial",
      },
      {
        id: 7,
        nombre: "JavaScript Fullstack",
        instructor: "Carlos P√©rez",
        inicio: "2025-11-15",
        duracion: "12 semanas",
        estado: "en_curso",
        nivel: "Intermedio",
        cupoTotal: 55,
        cupoOcupado: 55,
        precio: 520,
        leads: 112,
        conversion: 25,
        cac: 27,
        propuestaOrigen: null,
      },
      {
        id: 8,
        nombre: "Data Science con Python",
        instructor: "Ana Garc√≠a",
        inicio: "2025-10-01",
        duracion: "14 semanas",
        estado: "finalizado",
        nivel: "Avanzado",
        cupoTotal: 45,
        cupoOcupado: 42,
        precio: 580,
        leads: 98,
        conversion: 24,
        cac: 29,
        propuestaOrigen: null,
      },
    ];

    // ============================================
    // CONFIGURACI√ìN DE ESTADOS
    // ============================================
    const estadoConfig = {
      planificacion: {
        label: "Planificaci√≥n",
        icon: "üîµ",
        bg: "bg-blue-50 dark:bg-blue-950/30",
        text: "text-blue-700 dark:text-blue-400",
        border: "border-blue-200 dark:border-blue-900/50",
      },
      prelanzamiento: {
        label: "Pre-lanzamiento",
        icon: "üü°",
        bg: "bg-yellow-50 dark:bg-yellow-950/30",
        text: "text-yellow-700 dark:text-yellow-400",
        border: "border-yellow-200 dark:border-yellow-900/50",
      },
      abierto: {
        label: "Inscripciones Abiertas",
        icon: "üü¢",
        bg: "bg-green-50 dark:bg-green-950/30",
        text: "text-green-700 dark:text-green-400",
        border: "border-green-200 dark:border-green-900/50",
      },
      lleno: {
        label: "Cupos Llenos",
        icon: "üî¥",
        bg: "bg-red-50 dark:bg-red-950/30",
        text: "text-red-700 dark:text-red-400",
        border: "border-red-200 dark:border-red-900/50",
      },
      en_curso: {
        label: "En Curso",
        icon: "‚ö´",
        bg: "bg-purple-50 dark:bg-purple-950/30",
        text: "text-purple-700 dark:text-purple-400",
        border: "border-purple-200 dark:border-purple-900/50",
      },
      finalizado: {
        label: "Finalizado",
        icon: "‚úÖ",
        bg: "bg-gray-100 dark:bg-gray-800",
        text: "text-gray-700 dark:text-gray-400",
        border: "border-gray-300 dark:border-gray-700",
      },
    };

    interface Curso {
      id: number;
      nombre: string;
      instructor: string;
      inicio: string;
      duracion: string;
      estado: string;
      nivel: string;
      cupoTotal: number;
      cupoOcupado: number;
      precio: number;
      leads: number;
      conversion: number;
      cac: number;
      propuestaOrigen: string | null;
    }

    // ============================================
    // FUNCIONES AUXILIARES
    // ============================================
    function calcularPorcentajeLlenado(curso: Curso): number {
      return Math.round((curso.cupoOcupado / curso.cupoTotal) * 100);
    }

    function getProgressBarColor(porcentaje: number): string {
      if (porcentaje >= 90)
        return "bg-gradient-to-r from-red-500 to-orange-500";
      if (porcentaje >= 70)
        return "bg-gradient-to-r from-orange-500 to-yellow-500";
      if (porcentaje >= 40)
        return "bg-gradient-to-r from-yellow-500 to-green-500";
      return "bg-gradient-to-r from-green-500 to-emerald-500";
    }

    function calcularIngresosActuales(curso: Curso): number {
      return curso.cupoOcupado * curso.precio;
    }

    function calcularIngresosProyectados(curso: Curso): number {
      return curso.cupoTotal * curso.precio;
    }

    function getDiasHastaInicio(fechaInicio: string): number{
      const hoy = new Date();
      const inicio = new Date(fechaInicio);
      const diff = Math.ceil((inicio.getTime() - hoy.getTime()) / (1000 * 60 * 60 * 24));
      return diff;
    }

    // ============================================
    // RENDERIZAR CURSOS
    // ============================================
    function renderCursos(filtros: any = {}) {
      const container = document.getElementById("cursosList");
      const emptyState = document.getElementById("emptyState");
      if (!container) return;

      let filtered = cursos;

      // Filtro por estado
      if (filtros.estado && filtros.estado !== "todos") {
        filtered = filtered.filter((c) => c.estado === filtros.estado);
      }

      // Filtro por b√∫squeda
      if (filtros.busqueda) {
        filtered = filtered.filter((c) =>
          c.nombre.toLowerCase().includes(filtros.busqueda.toLowerCase())
        );
      }

      // Filtro por instructor
      if (filtros.instructor) {
        filtered = filtered.filter((c) => c.instructor === filtros.instructor);
      }

      // Filtro por nivel
      if (filtros.nivel) {
        filtered = filtered.filter((c) => c.nivel === filtros.nivel);
      }

      if (filtered.length === 0) {
        container.classList.add("hidden");
        emptyState?.classList.remove("hidden");
        return;
      }

      container.classList.remove("hidden");
      emptyState?.classList.add("hidden");

      container.innerHTML = filtered
        .map((c) => {
          const estado = estadoConfig[c.estado as keyof typeof estadoConfig];
          const porcentaje = calcularPorcentajeLlenado(c);
          const progressColor = getProgressBarColor(porcentaje);
          const ingresosActuales = calcularIngresosActuales(c);
          const ingresosProyectados = calcularIngresosProyectados(c);
          const diasInicio = getDiasHastaInicio(c.inicio);
          const roi =
            c.cac > 0 ? Math.round(((c.precio - c.cac) / c.cac) * 100) : 0;

          return `
          <a href="/marketing/cursos/${c.id}" 
             class="block p-6 bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl hover:shadow-xl smooth-transition group">
            
            <!-- Header -->
            <div class="flex items-start justify-between mb-4">
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <h3 class="text-xl font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 smooth-transition">
                    ${c.nombre}
                  </h3>
                  <span class="px-3 py-1 ${estado.bg} ${estado.text} border ${estado.border} rounded-full text-xs font-medium">
                    ${estado.icon} ${estado.label}
                  </span>
                </div>
                <div class="flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400">
                  <span class="flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    ${c.instructor}
                  </span>
                  <span class="flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    ${new Date(c.inicio).toLocaleDateString("es-ES", { day: "numeric", month: "short", year: "numeric" })}
                  </span>
                  <span class="flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    ${c.duracion}
                  </span>
                  ${
                    diasInicio > 0
                      ? `
                    <span class="px-2 py-0.5 bg-blue-50 dark:bg-blue-950/30 text-blue-600 dark:text-blue-400 rounded-full text-xs font-medium">
                      Inicia en ${diasInicio} d√≠as
                    </span>
                  `
                      : ""
                  }
                </div>
              </div>
            </div>

            <!-- Cupos Progress -->
            ${
              c.estado !== "planificacion"
                ? `
              <div class="mb-4">
                <div class="flex items-center justify-between text-sm mb-2">
                  <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 ${porcentaje >= 90 ? "text-red-500" : "text-green-500"}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span class="font-semibold ${porcentaje >= 90 ? "text-red-600 dark:text-red-400" : "text-green-600 dark:text-green-400"}">
                      ${c.cupoOcupado}
                    </span>
                    <span class="text-gray-500 dark:text-gray-400">/ ${c.cupoTotal} cupos</span>
                  </div>
                  <span class="text-xs font-medium ${porcentaje >= 90 ? "text-red-600 dark:text-red-400" : "text-green-600 dark:text-green-400"}">
                    ${porcentaje}%
                  </span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden">
                  <div class="h-3 rounded-full smooth-transition ${progressColor}" style="width: ${porcentaje}%"></div>
                </div>
              </div>
            `
                : `
              <div class="mb-4 p-3 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-900/50">
                <p class="text-sm text-blue-700 dark:text-blue-400">
                  üîµ Curso en planificaci√≥n - A√∫n sin fecha de inicio confirmada
                </p>
              </div>
            `
            }

            <!-- M√©tricas Grid -->
            ${
              c.estado !== "planificacion"
                ? `
              <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                <div class="p-3 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/30 dark:to-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-900/50">
                  <p class="text-xs text-blue-600 dark:text-blue-400 font-medium mb-1">Ingresos</p>
                  <p class="text-lg font-bold text-gray-900 dark:text-white">$${(ingresosActuales / 1000).toFixed(1)}K</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">de $${(ingresosProyectados / 1000).toFixed(1)}K</p>
                </div>

                <div class="p-3 bg-gradient-to-br from-green-50 to-green-100 dark:from-green-950/30 dark:to-green-900/20 rounded-lg border border-green-200 dark:border-green-900/50">
                  <p class="text-xs text-green-600 dark:text-green-400 font-medium mb-1">Conversi√≥n</p>
                  <p class="text-lg font-bold text-gray-900 dark:text-white">${c.conversion}%</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">${c.leads} leads</p>
                </div>

                <div class="p-3 bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-950/30 dark:to-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-900/50">
                  <p class="text-xs text-purple-600 dark:text-purple-400 font-medium mb-1">CAC</p>
                  <p class="text-lg font-bold text-gray-900 dark:text-white">$${c.cac}</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">por alumno</p>
                </div>

                <div class="p-3 bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-950/30 dark:to-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-900/50">
                  <p class="text-xs text-orange-600 dark:text-orange-400 font-medium mb-1">ROI</p>
                  <p class="text-lg font-bold text-gray-900 dark:text-white">${roi}%</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">Rentabilidad</p>
                </div>
              </div>
            `
                : ""
            }

            <!-- Footer -->
            <div class="flex items-center justify-between pt-3 border-t border-gray-200 dark:border-gray-800">
              <div class="flex items-center gap-2 text-sm">
                <span class="px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded text-xs font-medium">
                  ${c.nivel}
                </span>
                <span class="text-gray-500 dark:text-gray-400">‚Ä¢</span>
                <span class="text-gray-600 dark:text-gray-400 font-semibold">$${c.precio}</span>
                ${
                  c.propuestaOrigen
                    ? `
                  <span class="text-gray-500 dark:text-gray-400">‚Ä¢</span>
                  <span class="text-xs text-gray-500 dark:text-gray-400">
                    De: ${c.propuestaOrigen}
                  </span>
                `
                    : ""
                }
              </div>
              <div class="flex items-center gap-2 text-blue-600 dark:text-blue-400 font-medium text-sm group-hover:gap-3 smooth-transition">
                Ver detalles
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </div>
            </div>
          </a>
        `;
        })
        .join("");
    }

    // ============================================
    // EVENT LISTENERS
    // ============================================
    document.addEventListener("DOMContentLoaded", () => {
      renderCursos();

      let filtrosActuales: { 
        estado?: string; 
        busqueda?: string; 
        departamento?: string; 
        prioridad?: string; 
        viabilidad?: string; 
        instructor?: string; 
        nivel?: string;
          } = { estado: 'todas' };

      

      // Filtros de estado
      document.querySelectorAll(".filter-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".filter-btn").forEach((b) => {
            b.classList.remove("border-blue-500", "dark:border-blue-500");
            b.classList.add("border-gray-200", "dark:border-gray-800");
          });
          btn.classList.remove("border-gray-200", "dark:border-gray-800");
          btn.classList.add("border-blue-500", "dark:border-blue-500");

          filtrosActuales.estado = btn.getAttribute("data-filter") || "todos";
          renderCursos(filtrosActuales);
        });
      });

      

      // B√∫squeda
      const searchInput = document.getElementById("searchInput");
      searchInput?.addEventListener("input", (e) => {
        const target = e.target as HTMLInputElement;
        filtrosActuales.busqueda = target.value;
        renderCursos(filtrosActuales);
      });

      // Filtro instructor
      const filterInstructor = document.getElementById("filterInstructor");
      filterInstructor?.addEventListener("change", (e) => {
        const target = e.target as HTMLInputElement;
        filtrosActuales.instructor = target.value;
        renderCursos(filtrosActuales);
      });

      // Filtro nivel
      const filterNivel = document.getElementById("filterNivel");
      filterNivel?.addEventListener("change", (e) => {
        const target = e.target as HTMLInputElement;
        filtrosActuales.nivel = target.value;
        renderCursos(filtrosActuales);
      });

      // Limpiar filtros
      const btnLimpiarFiltros = document.getElementById("btnLimpiarFiltros");
      btnLimpiarFiltros?.addEventListener("click", () => {
        filtrosActuales = { estado: "todos" };
        if (searchInput) (searchInput as HTMLInputElement).value = '';
        if (filterInstructor) (filterInstructor as HTMLSelectElement).value = "";
        if (filterNivel) (filterNivel as HTMLSelectElement).value = "";

        document.querySelectorAll(".filter-btn").forEach((b) => {
          b.classList.remove("border-blue-500", "dark:border-blue-500");
          b.classList.add("border-gray-200", "dark:border-gray-800");
        });
        document
          .querySelector('[data-filter="todos"]')
          ?.classList.add("border-blue-500", "dark:border-blue-500");
        document
          .querySelector('[data-filter="todos"]')
          ?.classList.remove("border-gray-200", "dark:border-gray-800");

        renderCursos(filtrosActuales);
      });
    });
  </script>
</Layout>
